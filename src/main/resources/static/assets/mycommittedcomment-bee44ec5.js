
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{R as d,S as A,N as p,u as X,n as Y,a as r,o as s,c as g,f as l,g as t,M as y,U as E,I as f,i as b,b as S,J as C,V as J,q as I,Q,_ as G,O as H}from"./index-fcfafe90.js";import{_ as K}from"./index-dacc811f.js";const Z=X(),q={data(){return{columnFields:[],commentsData:{list:[],currPage:1,pageSize:20,total:0,totalPage:0},showEditDialog:!1,dialogTitle:"",dialogType:"",batchBtnEnable:!1,search:{pageSize:20,pageIndex:1,sortBy:"createTime",sortType:"desc",queryParams:{}},departmentTree:{},listProjects:[],listUsers:[],selectedRoles:[],confirmResultItems:[],selectedRows:[],editDetail:{},editFieldRules:{name:[{required:!0,message:"用户姓名必填",trigger:"blur"}],account:[{required:!0,message:"用户账号必填",trigger:"blur"}]},languageType:"java"}},computed:{},mounted(){this.resetSearch(),this.getColumnFields(),this.loadUserList(),this.loadProjects(),this.loadConfirmResultItems(),this.loadDepartmentTree()},methods:{loadUserList(){d.get("server/user/getAllUserDetails").then(u=>{this.listUsers=u.data})},loadProjects(){d.get(`server/project/queryProjectInDept?deptId=${this.search.queryParams.departmentId}`).then(u=>{this.listProjects=u.data})},loadConfirmResultItems(){d.get("server/column/queryConfirmResultDictItems").then(u=>{this.confirmResultItems=u.data})},getColumnFields(){d.get("server/column/queryColumns").then(u=>{this.columnFields=u.data})},loadDepartmentTree(){d.get("server/dept/getDeptTree").then(u=>{this.departmentTree=u.data})},clickSearch(){d.post("/server/comment/queryComments",this.search).then(u=>{this.commentsData=u.data})},resetSearch(){this.search.queryParams={identifier:null,projectId:null,departmentId:null,commitUser:Z.account,realConfirmUser:null,assignConfirmUser:null,confirmResult:null},this.clickSearch()},handleSizeChange(u){this.search.pageSize=u,this.clickSearch()},handleCurrentChange(u){this.search.pageIndex=u,this.clickSearch()},getSelectedRows(u){this.selectedRows=u,this.selectedRows&&this.selectedRows.length!==0?this.batchBtnEnable=!0:this.batchBtnEnable=!1},exportData(u){d.post("/server/comment/exportComments",this.search,{responseType:"blob"}).then(i=>{let c="review_comment_"+Date.now()+".xlsx",v=new Blob([i]);if("msSaveOrOpenBlob"in navigator)window.navigator.msSaveOrOpenBlob(v,c);else{let a=window.URL.createObjectURL(v),n=document.createElement("a");n.href=a,n.download=c,n.click(),window.URL.revokeObjectURL(a)}})},deleteSelection(u){A.confirm("确定要删除所选记录吗？此操作不可恢复！","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const i=[];for(let c=0;c<this.selectedRows.length;c++){const v=this.selectedRows[c];i.push(v.identifier)}d.get(`server/comment/deleteComments?identifiers=${i}`).then(c=>{c.code===0?p({type:"success",message:"删除成功"}):p({type:"error",message:`删除失败：${c.message}`}),this.clickSearch()})}).catch(()=>{})},deleteSingle(u){A.confirm("确定要删除此记录吗？此操作不可恢复！","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.get(`server/comment/deleteComment?identifier=${u.identifier}`).then(i=>{i.code===0?p({type:"success",message:"删除成功"}):p({type:"error",message:`删除失败：${i.message}`}),this.clickSearch()})}).catch(()=>{})},viewSingle(u){this.showEditDialog=!1,d.get(`server/comment/initViewReqBody?identifier=${u.identifier}`).then(i=>{this.editDetail=i.data,this.dialogTitle="评审意见详情",this.dialogType="VIEW",this.showEditDialog=!0,this.languageType=this.editDetail.codeType}).catch(i=>{p({type:"error",message:`编辑失败：${i}`})})},editSingle(u){this.showEditDialog=!1,d.get(`server/comment/initEditReqBody?identifier=${u.identifier}`).then(i=>{this.editDetail=i.data,this.dialogTitle="修改评审意见",this.dialogType="EDIT",this.showEditDialog=!0}).catch(i=>{p({type:"error",message:`编辑失败：${i.message}`})})},saveOperation(){this.$refs.editDetailForm.validate(u=>{if(!u)p({type:"error",message:"参数内容填写有误，请检查"});else{let i;if(this.dialogType==="CREATE")i="server/comment/createComment";else if(this.dialogType==="EDIT")i="server/comment/modifyComment";else if(this.dialogType==="CONFIRM")i="server/comment/confirmComment";else{p({type:"error",message:"请求操作类型不合法"});return}d.post(i,this.editDetail).then(c=>{c.code===0?(p({type:"success",message:"保存成功"}),this.showEditDialog=!1,this.clickSearch()):p({type:"error",message:`编辑失败：${c.message}`})})}})},cancelEditOperation(){this.showEditDialog=!1},create(){this.showEditDialog=!1,d.get("server/comment/initCreateReqBody").then(u=>{this.editDetail=u.data,this.dialogTitle="添加评审意见",this.dialogType="CREATE",this.showEditDialog=!0}).catch(u=>{p({type:"error",message:`编辑失败：${u}`})})},cancelCreateOperation(){this.showEditDialog=!1},confirmSingle(u){this.showEditDialog=!1,d.get(`server/comment/initConfirmReqBody?identifier=${u.identifier}`).then(i=>{this.editDetail=i.data,this.dialogTitle="评审意见确认",this.dialogType="CONFIRM",this.showEditDialog=!0}).catch(i=>{p({type:"error",message:`编辑失败：${i}`})})}}};const $={class:"button-group"},ee={key:0},le={style:{width:"100%","line-height":"30px",padding:"5px"}},te={class:"dialog-footer"};function ae(u,i,c,v,a,n){const x=Q,w=r("el-option"),B=r("el-select"),m=r("el-form-item"),D=r("el-col"),U=r("el-row"),k=r("el-input"),M=r("el-tree-select"),T=G,F=r("el-icon"),_=r("el-button"),P=r("el-form"),L=K,R=H,V=r("el-table-column"),j=r("el-table"),N=r("el-pagination"),O=r("el-date-picker"),z=r("highlightjs"),W=r("el-dialog");return s(),g("div",null,[l(x,{title:"我提交的",content:"本页面展示所有您提交的检视意见，您可以在此页面查看、编辑、删除已提交的内容，或者新建并提交新的检视意见。"}),l(R,{title:"搜索条件"},{default:t(()=>[l(L,null,{default:t(()=>[l(P,{model:a.search,size:"default","label-width":"120px"},{default:t(()=>[l(U,null,{default:t(()=>[l(D,{span:6},{default:t(()=>[l(m,{label:"指派确认人员"},{default:t(()=>[l(B,{modelValue:a.search.queryParams.assignConfirmUser,"onUpdate:modelValue":i[0]||(i[0]=e=>a.search.queryParams.assignConfirmUser=e),modelModifiers:{trim:!0},placeholder:"请输入姓名或账号查询",clearable:"",filterable:""},{default:t(()=>[(s(!0),g(y,null,E(a.listUsers,(e,o)=>(s(),f(w,{key:e.account,label:e.name,value:e.account},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(D,{span:6},{default:t(()=>[l(m,{label:"实际确认人员"},{default:t(()=>[l(B,{modelValue:a.search.queryParams.realConfirmUser,"onUpdate:modelValue":i[1]||(i[1]=e=>a.search.queryParams.realConfirmUser=e),modelModifiers:{trim:!0},placeholder:"请输入姓名或账号查询",clearable:"",filterable:""},{default:t(()=>[(s(!0),g(y,null,E(a.listUsers,(e,o)=>(s(),f(w,{key:e.account,label:e.name,value:e.account},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(D,{span:6},{default:t(()=>[l(m,{label:"确认结果"},{default:t(()=>[l(B,{modelValue:a.search.queryParams.confirmResult,"onUpdate:modelValue":i[2]||(i[2]=e=>a.search.queryParams.confirmResult=e),modelModifiers:{trim:!0},placeholder:"输入评审意见的确认状态",clearable:""},{default:t(()=>[(s(!0),g(y,null,E(a.confirmResultItems,(e,o)=>(s(),f(w,{key:e.value,label:e.showName,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(D,{span:6},{default:t(()=>[l(m,{label:"唯一ID"},{default:t(()=>[l(k,{modelValue:a.search.queryParams.identifier,"onUpdate:modelValue":i[3]||(i[3]=e=>a.search.queryParams.identifier=e),placeholder:"输入评审意见唯一ID进行查询",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(D,{span:6},{default:t(()=>[l(m,{label:"归属部门"},{default:t(()=>[l(M,{clearable:"",modelValue:a.search.queryParams.departmentId,"onUpdate:modelValue":i[4]||(i[4]=e=>a.search.queryParams.departmentId=e),data:a.departmentTree,"render-after-expand":!1,"check-strictly":"true",onChange:n.loadProjects},null,8,["modelValue","data","onChange"])]),_:1})]),_:1}),l(D,{span:6},{default:t(()=>[l(m,{label:"归属项目"},{default:t(()=>[l(B,{modelValue:a.search.queryParams.projectId,"onUpdate:modelValue":i[5]||(i[5]=e=>a.search.queryParams.projectId=e),modelModifiers:{trim:!0},placeholder:"请选择",clearable:"",filterable:""},{default:t(()=>[(s(!0),g(y,null,E(a.listProjects,(e,o)=>(s(),f(w,{key:e.id,label:e.projectName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(_,{type:"primary",onClick:n.clickSearch},{icon:t(()=>[l(F,null,{default:t(()=>[l(T,{name:"ep:search"})]),_:1})]),default:t(()=>[b(" 查询 ")]),_:1},8,["onClick"]),l(_,{onClick:n.resetSearch},{default:t(()=>[b(" 重置 ")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),l(R,null,{default:t(()=>[S("div",$,[l(_,{type:"primary",onClick:n.create},{icon:t(()=>[l(F,null,{default:t(()=>[l(T,{name:"ep:circle-plus"})]),_:1})]),default:t(()=>[b(" 新建 ")]),_:1},8,["onClick"]),l(_,{type:"danger",disabled:!a.batchBtnEnable,onClick:n.deleteSelection},{icon:t(()=>[l(F,null,{default:t(()=>[l(T,{name:"ep:delete"})]),_:1})]),default:t(()=>[b(" 删除所选 ")]),_:1},8,["disabled","onClick"]),l(_,{type:"default",onClick:n.exportData},{icon:t(()=>[l(F,null,{default:t(()=>[l(T,{name:"ep:download"})]),_:1})]),default:t(()=>[b(" 数据导出 ")]),_:1},8,["onClick"])]),l(j,{border:"","highlight-current-row":"",data:a.commentsData.list,height:"100%",onSelectionChange:n.getSelectedRows},{default:t(()=>[l(V,{type:"selection",width:"55"}),(s(!0),g(y,null,E(a.columnFields,(e,o)=>(s(),g(y,null,[e.showInWebTable?(s(),f(V,{key:e.columnCode,prop:e.columnCode,label:e.showName,width:e.webTableColumnWidth,index:o},null,8,["prop","label","width","index"])):C("",!0)],64))),256)),l(V,{fixed:"right",label:"操作",width:"200"},{default:t(e=>[l(_,{link:"",type:"primary",size:"small",onClick:o=>n.viewSingle(e.row)},{default:t(()=>[b(" 查看 ")]),_:2},1032,["onClick"]),l(_,{link:"",type:"primary",size:"small",onClick:o=>n.editSingle(e.row)},{default:t(()=>[b(" 编辑 ")]),_:2},1032,["onClick"]),l(_,{link:"",type:"danger",size:"small",onClick:o=>n.deleteSingle(e.row)},{default:t(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"]),l(N,{class:"pageination-style",background:"",layout:"total, sizes, prev, pager, next, jumper","page-size":a.commentsData.pageSize,total:a.commentsData.total,"current-page":a.commentsData.currPage,onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange},null,8,["page-size","total","current-page","onSizeChange","onCurrentChange"])]),_:1}),l(W,{modelValue:a.showEditDialog,"onUpdate:modelValue":i[6]||(i[6]=e=>a.showEditDialog=e),title:a.dialogTitle},J({default:t(()=>[l(P,{ref:"editDetailForm",model:a.editDetail,size:"default","label-width":"120px",rules:a.editFieldRules},{default:t(()=>[(s(!0),g(y,null,E(a.editDetail.fieldModelList,(e,o)=>(s(),g(y,null,[e.show?(s(),g("div",ee,[e.inputType=="TEXT"?(s(),f(m,{key:0,label:e.showName},{default:t(()=>[l(k,{modelValue:a.editDetail.fieldModelList[o].valuePair.value,"onUpdate:modelValue":h=>a.editDetail.fieldModelList[o].valuePair.value=h,disabled:e.editable===!1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"])):C("",!0),e.inputType=="COMBO_BOX"?(s(),f(m,{key:1,label:e.showName},{default:t(()=>[l(B,{modelValue:a.editDetail.fieldModelList[o].valuePair,"onUpdate:modelValue":h=>a.editDetail.fieldModelList[o].valuePair=h,disabled:e.editable===!1,filterable:""},{default:t(()=>[(s(!0),g(y,null,E(e.enumValues,h=>(s(),f(w,{label:h.showName,value:h},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"])):C("",!0),e.inputType=="DATE"?(s(),f(m,{key:2,label:e.showName},{default:t(()=>[l(O,{disabled:e.editable===!1,modelValue:a.editDetail.fieldModelList[o].valuePair.value,"onUpdate:modelValue":h=>a.editDetail.fieldModelList[o].valuePair.value=h,type:"date","value-format":"YYYY-MM-DD",placeholder:"点击选择日期"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):C("",!0),e.inputType=="TEXTAREA"&&e.code=="content"&&e.editable===!1?(s(),f(m,{key:3,label:e.showName},{default:t(()=>[S("div",le,[l(z,{language:a.languageType,code:a.editDetail.fieldModelList[o].valuePair.value},null,8,["language","code"])])]),_:2},1032,["label"])):C("",!0),e.inputType=="TEXTAREA"&&e.code=="content"&&e.editable===!0?(s(),f(m,{key:4,label:e.showName},{default:t(()=>[l(k,{modelValue:a.editDetail.fieldModelList[o].valuePair.value,"onUpdate:modelValue":h=>a.editDetail.fieldModelList[o].valuePair.value=h,rows:5,disabled:e.editable===!1,type:"textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"])):C("",!0),e.inputType=="TEXTAREA"&&e.code!="content"?(s(),f(m,{key:5,label:e.showName},{default:t(()=>[l(k,{modelValue:a.editDetail.fieldModelList[o].valuePair.value,"onUpdate:modelValue":h=>a.editDetail.fieldModelList[o].valuePair.value=h,rows:5,disabled:e.editable===!1,type:"textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["label"])):C("",!0)])):C("",!0)],64))),256))]),_:1},8,["model","rules"])]),_:2},[a.dialogType!=="VIEW"?{name:"footer",fn:t(()=>[S("span",te,[l(_,{onClick:n.cancelEditOperation},{default:t(()=>[b(" 取消 ")]),_:1},8,["onClick"]),l(_,{type:"primary",onClick:n.saveOperation},{default:t(()=>[b(" 保存 ")]),_:1},8,["onClick"])])]),key:"0"}:void 0]),1032,["modelValue","title"])])}typeof I=="function"&&I(q);const se=Y(q,[["render",ae],["__scopeId","data-v-36b0985f"]]);export{se as default};
//# sourceMappingURL=mycommittedcomment-bee44ec5.js.map
